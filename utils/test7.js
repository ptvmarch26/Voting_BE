// // utils/test7.js
// import { buildBabyjub } from "circomlibjs";
// import fs from "fs/promises";

// const s_i_str =
//   "288047908067672580341451203259985360060331758011544889427840988588462024566";

// const C1_total_x = [
//     "8139839388008960064803628581285923788253614451946212517010081789567948666321",
//     "4228922128992469749168909599632723007475199242665111204260357615014053347363",
//     "19417815585408158981765273416858582339471902325510420997702256845607066774494",
//     "828945185500400835221981355675273009232075098616700601227231488472709595565",
//     "20167771626377530065031264730699678484467232067169922154872860527229786734629",
//     "1741379626878414825522418733813690873267652028089016249466011603163975971278",
//     "8519963095218762846591783036665999388005684627469671481898373495893825212420",
//     "6513029914392879055822622813762813700382632989008451852231217360467112695993",
//     "13243879580937756521670258311801928455112540338239853481855813024728960865741",
//     "18978096793879451203896249596073174603734703056775329243463296316722402437681"
//   ];

// const C1_total_y = [
//     "15180322544242182033591435287300895039903588746023996874479930294631267166150",
//     "10295760113107279135831022875121599451889344465173363485201499752391357458833",
//     "1913761420228267687233782345596333827787121704922994601226262784998502607600",
//     "21474530432264756900074261231999676839747437443153109844348498039438793279702",
//     "10708633255664576572871633842684709883511404534900065816680971506400202981623",
//     "14424965179784438518477314917909958192275203569891182364462158542458757821938",
//     "11911063716327326335738070184727026107793805843274160393951440039018042885260",
//     "7365422419634463429217911325553740559248579476593986434553676860548502930395",
//     "5311678348510326121120255310546507808779126540490983279007123219338623192041",
//     "17876706745641218164575363428187589847337682607786688438533805487663268522197"
//   ];

// (async () => {
//   const babyjub = await buildBabyjub();
//   const F = babyjub.F;

//   const s_i = BigInt(s_i_str);

//   // --- Cá»™ng cÃ¡c Ä‘iá»ƒm C1_j láº¡i Ä‘á»ƒ ra C1_total ---
//   let C1_total = [F.e(BigInt(C1_total_x[0])), F.e(BigInt(C1_total_y[0]))];

//   for (let i = 1; i < C1_total_x.length; i++) {
//     const nextPoint = [F.e(BigInt(C1_total_x[i])), F.e(BigInt(C1_total_y[i]))];
//     C1_total = babyjub.addPoint(C1_total, nextPoint);
//   }

//   console.log("âœ… Cá»™ng xong cÃ¡c C1_j â†’ C1_total:");
//   console.log({
//     C1_total_x: F.toObject(C1_total[0]).toString(),
//     C1_total_y: F.toObject(C1_total[1]).toString(),
//   });

//   // --- TÃ­nh D_i = s_i * C1_total ---
//   const D_i = babyjub.mulPointEscalar(C1_total, s_i);

//   const D_ix = F.toObject(D_i[0]).toString();
//   const D_iy = F.toObject(D_i[1]).toString();

//   const output = { D_ix, D_iy };
//   await fs.writeFile("D_i_output.json", JSON.stringify(output, null, 2));

//   console.log("âœ… Partial decrypt computed:");
//   console.log(output);
// })();

// utils/test7.js
import { buildBabyjub } from "circomlibjs";
import fs from "fs/promises";

// --- Trustee's secret share (s_i) ---
const s_i_str =
  "288047908067672580341451203259985360060331758011544889427840988588462024566"; // trustee i

// --- C1_total cho 10 á»©ng viÃªn ---
const C1_total_x = [
  '260782430461292267488667376170459157024131187645955713628162972587994131815',
  '6298909175823773637862220133863286870165368824605378816006469024132083245750',
  '14051808604514731673534751215028016611431528431668060254360273858513160639101',
  '9848563098960520557788161498589345608379917208231828893587765644362999738904',
  '13837473322602961038054960312089106858240956814130888192606133307026865931340',
  '18927536340485066104182473019241798360133028491446400074227579824627652667712',
  '10824295577655767908786580974905401114753445632512924643623474790949612862549',
  '3963443427527366362768907809247082645424899001925429666913669316048215458884',
  '17726565243998810686521954996982059928909685948423270988255748659174815769535',
  '10729450187106873419181950011123265503808640746067816907369395555953610334231'
];

const C1_total_y = [
  '9119326491856815560420921053165473480892366463103185332204247190501790655748',
  '14080844412325591495338430975472091538271170257866876788588256371316429730302',
  '5906697323761754427494609754548205288137203392204307755257335011673869228851',
  '17151070606111302721932996713669428330258086937071268365793767348914656132547',
  '5631641441420733210444920384101501653284050909822927838387908716592931621254',
  '3280956905925568203182651683677564425467844201469223204637791254091064088210',
  '803653997898200519445385141133166982760334232432171442491853025355879949596',
  '10175875800346528054162601069922825428936471664160797637428194893587186779795',
  '7575512711781576733558303352632148051859271915913426931538535483411554885748',
  '11954244491732804069913220584122693643718254194516804990313733585807613637742'
];

(async () => {
  const babyjub = await buildBabyjub();
  const F = babyjub.F;
  const s_i = BigInt(s_i_str);

  const D_all = [];

  // --- Báº¯t Ä‘áº§u tÃ­nh tá»•ng C1_total (cá»™ng háº¿t 10 Ä‘iá»ƒm láº¡i)
  let C1_sum = [
    F.e(BigInt(C1_total_x[0])),
    F.e(BigInt(C1_total_y[0])),
  ];

  for (let i = 1; i < C1_total_x.length; i++) {
    const nextPoint = [
      F.e(BigInt(C1_total_x[i])),
      F.e(BigInt(C1_total_y[i])),
    ];
    C1_sum = babyjub.addPoint(C1_sum, nextPoint);
  }

  const C1_sum_x = F.toObject(C1_sum[0]).toString();
  const C1_sum_y = F.toObject(C1_sum[1]).toString();

  console.log("ðŸ§® Tá»•ng cá»™ng táº¥t cáº£ C1_total[i] láº¡i â†’ C1_sum:");
  console.log("   C1x_total =", C1_sum_x);
  console.log("   C1y_total =", C1_sum_y);

  // --- TÃ­nh D_i cho tá»«ng á»©ng viÃªn (nhÆ° cÅ©)
  for (let i = 0; i < C1_total_x.length; i++) {
    const C1_point = [
      F.e(BigInt(C1_total_x[i])),
      F.e(BigInt(C1_total_y[i])),
    ];
    const D_i = babyjub.mulPointEscalar(C1_point, s_i);

    D_all.push([
      F.toObject(D_i[0]).toString(),
      F.toObject(D_i[1]).toString(),
    ]);
  }

  // --- TÃ­nh D_total = s_i * C1_sum (proof sáº½ dÃ¹ng cÃ¡i nÃ y)
  const D_total = babyjub.mulPointEscalar(C1_sum, s_i);
  const D_total_x = F.toObject(D_total[0]).toString();
  const D_total_y = F.toObject(D_total[1]).toString();

  console.log("ðŸ§© D_total = s_i * (C1_sum):");
  console.log("   D_ix_total =", D_total_x);
  console.log("   D_iy_total =", D_total_y);

  // --- Ghi file káº¿t quáº£
  const outputPath = "utils/D_i_array2.json";
  await fs.writeFile(outputPath, JSON.stringify(D_all, null, 2));

  console.log("âœ… ÄÃ£ táº¡o danh sÃ¡ch D_i dáº¡ng máº£ng Ä‘Æ¡n giáº£n.");
  console.log(`ðŸ“„ LÆ°u táº¡i: ${outputPath}`);
})();
