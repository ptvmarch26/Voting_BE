// // utils/test7.js
// import { buildBabyjub } from "circomlibjs";
// import fs from "fs/promises";

// const s_i_str =
//   "288047908067672580341451203259985360060331758011544889427840988588462024566";

// const C1_total_x = [
//     "8139839388008960064803628581285923788253614451946212517010081789567948666321",
//     "4228922128992469749168909599632723007475199242665111204260357615014053347363",
//     "19417815585408158981765273416858582339471902325510420997702256845607066774494",
//     "828945185500400835221981355675273009232075098616700601227231488472709595565",
//     "20167771626377530065031264730699678484467232067169922154872860527229786734629",
//     "1741379626878414825522418733813690873267652028089016249466011603163975971278",
//     "8519963095218762846591783036665999388005684627469671481898373495893825212420",
//     "6513029914392879055822622813762813700382632989008451852231217360467112695993",
//     "13243879580937756521670258311801928455112540338239853481855813024728960865741",
//     "18978096793879451203896249596073174603734703056775329243463296316722402437681"
//   ];

// const C1_total_y = [
//     "15180322544242182033591435287300895039903588746023996874479930294631267166150",
//     "10295760113107279135831022875121599451889344465173363485201499752391357458833",
//     "1913761420228267687233782345596333827787121704922994601226262784998502607600",
//     "21474530432264756900074261231999676839747437443153109844348498039438793279702",
//     "10708633255664576572871633842684709883511404534900065816680971506400202981623",
//     "14424965179784438518477314917909958192275203569891182364462158542458757821938",
//     "11911063716327326335738070184727026107793805843274160393951440039018042885260",
//     "7365422419634463429217911325553740559248579476593986434553676860548502930395",
//     "5311678348510326121120255310546507808779126540490983279007123219338623192041",
//     "17876706745641218164575363428187589847337682607786688438533805487663268522197"
//   ];

// (async () => {
//   const babyjub = await buildBabyjub();
//   const F = babyjub.F;

//   const s_i = BigInt(s_i_str);

//   // --- Cá»™ng cÃ¡c Ä‘iá»ƒm C1_j láº¡i Ä‘á»ƒ ra C1_total ---
//   let C1_total = [F.e(BigInt(C1_total_x[0])), F.e(BigInt(C1_total_y[0]))];

//   for (let i = 1; i < C1_total_x.length; i++) {
//     const nextPoint = [F.e(BigInt(C1_total_x[i])), F.e(BigInt(C1_total_y[i]))];
//     C1_total = babyjub.addPoint(C1_total, nextPoint);
//   }

//   console.log("âœ… Cá»™ng xong cÃ¡c C1_j â†’ C1_total:");
//   console.log({
//     C1_total_x: F.toObject(C1_total[0]).toString(),
//     C1_total_y: F.toObject(C1_total[1]).toString(),
//   });

//   // --- TÃ­nh D_i = s_i * C1_total ---
//   const D_i = babyjub.mulPointEscalar(C1_total, s_i);

//   const D_ix = F.toObject(D_i[0]).toString();
//   const D_iy = F.toObject(D_i[1]).toString();

//   const output = { D_ix, D_iy };
//   await fs.writeFile("D_i_output.json", JSON.stringify(output, null, 2));

//   console.log("âœ… Partial decrypt computed:");
//   console.log(output);
// })();

// utils/test7.js
import { buildBabyjub } from "circomlibjs";
import fs from "fs/promises";

// --- Trustee's secret share (s_i) ---
const s_i_str =
  "288047908067672580341451203259985360060331758011544889427840988588462024566"; // trustee i

// --- C1_total cho 10 á»©ng viÃªn ---
const C1_total_x = [
  '4403609409219224770875184923229204175059911321372726895221936004776127180087',
  '13643600974782645514273787617220177192764753741663339870585355753471766980023',
  '16513572157192048046022182836305350015442048604211494327189438226879741803496',
  '17414459441147199830524370355200623840434708602438901357244722626603171660544',
  '16348987386647019404890344310184962252137929685167132903383579284542656635756',
  '2405116659949910868845806000000947911612382651641970746730170104418671355320',
  '19626126049334772312125002948361541615144999562840464160037053371288043471249',
  '16355349858912545367835675923208671057156588929498901450538722504748270916593',
  '9548290657024083970538236917821885532645126657551921666283079159404671716042',
  '9553406264974006567035409145553604106769141074824044276861472920166813131374'
];

const C1_total_y = [
  '2487494418597161416658681354358509946968215548809434566549512989517409709575',
  '1532519226445881633305217765562336241381328213231189974815297993615066006345',
  '12323539106599495962663890541222017607657057981708023122705037554713756395042',
  '1734593856355947696031056101780386686524287711622132880966127247311187117500',
  '13625102663048668970080118648687461887136688623370028650035914612071034317493',
  '21502595654533141366954273389901066992744534274910581593506408017723840148292',
  '20404170923008902373687099344125893815847063437902761761720823917111165034391',
  '4226965494541285040601159990163751277454136601452451710895941504440566494560',
  '4788582178638946498650203246232004882143283318379453643213296208387350775417',
  '1568851383508273265649027488401784723223900333562585281293003642529677778870'
];

(async () => {
  const babyjub = await buildBabyjub();
  const F = babyjub.F;
  const s_i = BigInt(s_i_str);

  const D_all = [];

  // --- Báº¯t Ä‘áº§u tÃ­nh tá»•ng C1_total (cá»™ng háº¿t 10 Ä‘iá»ƒm láº¡i)
  let C1_sum = [
    F.e(BigInt(C1_total_x[0])),
    F.e(BigInt(C1_total_y[0])),
  ];

  for (let i = 1; i < C1_total_x.length; i++) {
    const nextPoint = [
      F.e(BigInt(C1_total_x[i])),
      F.e(BigInt(C1_total_y[i])),
    ];
    C1_sum = babyjub.addPoint(C1_sum, nextPoint);
  }

  const C1_sum_x = F.toObject(C1_sum[0]).toString();
  const C1_sum_y = F.toObject(C1_sum[1]).toString();

  console.log("ðŸ§® Tá»•ng cá»™ng táº¥t cáº£ C1_total[i] láº¡i â†’ C1_sum:");
  console.log("   C1x_total =", C1_sum_x);
  console.log("   C1y_total =", C1_sum_y);

  // --- TÃ­nh D_i cho tá»«ng á»©ng viÃªn (nhÆ° cÅ©)
  for (let i = 0; i < C1_total_x.length; i++) {
    const C1_point = [
      F.e(BigInt(C1_total_x[i])),
      F.e(BigInt(C1_total_y[i])),
    ];
    const D_i = babyjub.mulPointEscalar(C1_point, s_i);

    D_all.push([
      F.toObject(D_i[0]).toString(),
      F.toObject(D_i[1]).toString(),
    ]);
  }

  // --- TÃ­nh D_total = s_i * C1_sum (proof sáº½ dÃ¹ng cÃ¡i nÃ y)
  const D_total = babyjub.mulPointEscalar(C1_sum, s_i);
  const D_total_x = F.toObject(D_total[0]).toString();
  const D_total_y = F.toObject(D_total[1]).toString();

  console.log("ðŸ§© D_total = s_i * (C1_sum):");
  console.log("   D_ix_total =", D_total_x);
  console.log("   D_iy_total =", D_total_y);

  // --- Ghi file káº¿t quáº£
  const outputPath = "utils/D_i_array2.json";
  await fs.writeFile(outputPath, JSON.stringify(D_all, null, 2));

  console.log("âœ… ÄÃ£ táº¡o danh sÃ¡ch D_i dáº¡ng máº£ng Ä‘Æ¡n giáº£n.");
  console.log(`ðŸ“„ LÆ°u táº¡i: ${outputPath}`);
})();
